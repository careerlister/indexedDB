function DB(i){var q=this,y=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB,z=window.IDBKeyRange||window.webkitIDBKeyRange||window.mozIDBKeyRange,A=(window.IDBTransaction||window.webkitIDBTransaction).readwrite||"readwrite",r,v,s,t,h,u,w,n,g,j,x,aa="Invalid parameter: ",bb="Could not get object store ",cc="Error ",dd="delete",ee="continue";x=function(a){this.message=a};x.prototype.toString=function(){return"IndexedDBException: "+this.message};h=function(a,f,c){a&&a instanceof Function&&a.apply(f,c)};u=function(a){return"[object Array]"===Object.prototype.toString.call(a)};w=function(a){debug&&
(console&&console.log)&&console.log(a)};n=function(a,f,c){var b;try{b=c?a.transaction(f,"readwrite"):a.transaction(f)}catch(d){w(d.message)}if(!b)try{b=c?a.transaction([f],A):a.transaction([f])}catch(e){w(e.message)}return b};g=function(a,f){if(!a)throw new x(f);};v=""+i.name;s=parseInt(i.version,10);t=i.schema;g(v.length,aa+"name <string>");g(s,aa+"version <int>");g(u(t),aa+"schema <array>");if(!y)return h(i.error,q,[!1,$e]),!1;r=y.open(v,s);r.onerror=
function(a){h(i.error,q,[!0,a])};r.onupgradeneeded=function(a){for(var f=a.target.result,c,b,d,e=0,k=t.length;e<k;e++)if(b=t[e],c=f.createObjectStore(b.name,b.key),u(b.indexes)){for(var g=0,l=b.indexes.length;g<l;g++)d=b.indexes[g],c.createIndex(d.name,d.field,{unique:!!d.unique});h(i.upgrade,q,[a])}};r.onsuccess=function(a){var f=r.result,c=new j(f);s!==f.version?(a=f.setVersion(s),a.onerror=function(a){h(i.upgradeError,q,[a])},a.onsuccess=function(a){for(var d,e,k,g=0,l=schema.length;g<l;g++)if(e=
schema[g],d=f.createObjectStore(e.name,e.key),u(e.indexes)){for(var p=0,m=e.indexes.length;p<m;p++)k=e.indexes[p],d.createIndex(k.name,k.field,{unique:!!k.unique});h(i.upgrade,q,[a])}a.target.transaction.oncomplete=function(a){h(i.success,q,[c,a])}}):h(i.success,q,[c,a])};j=function(a){this.db=a};j.prototype.insert=function(a){var f=this,c=a.store,b=a.data,d=!!a.repl,e=n(this.db,c,!0),k,i,l=[],p=[],m;g(e,cc+"inserting to "+c);k=e.objectStore(c);g(k,bb+c);m=function(c){l.length+
p.length===j&&h(a.error,f,[l,p,c])};for(var c=function(a){try{i=d?k.put(a):k.add(a)}catch(c){p.push(a),m({})}i&&(i.onsuccess=function(c){l.push(a);m(c)},i.onerror=function(c){p.push(a);m(c)})},e=0,j=b.length;e<j;e++)c(b[e])};j.prototype[dd]=function(a){var f=this,c=a.store,b=a.id,d=n(this.db,c,!0);g(d,cc+"deleting "+b+" from "+c);d=d.objectStore(c);g(d,bb+c);c=d[dd](b);c.onsuccess=function(c){h(a.success,f,[b,c])};c.onerror=function(c){h(a.error,f,[b,c])}};
j.prototype.get=function(a){var f=this,c=a.store,b=a.id,d=n(this.db,c),e;g(d,cc+"getting "+b+" from "+c);d=d.objectStore(c);g(d,bb+c);e=d.get(b);e.onsuccess=function(b){h(a.success,f,[e.result,c,b])};e.onerror=function(d){h(a.error,f,[b,c,d])}};j.prototype.all=function(a){var f=this,c=a.store,b=n(this.db,c),d,e=[];g(b,cc+"getting all from "+c);b=b.objectStore(c);g(b,bb+c);b=b.openCursor();b.onsuccess=function(b){(d=b.target.result)?(e.push(d.value),
d[ee]()):h(a.success,f,[e,c,b])};b.onerror=function(b){h(a.error,f,[c,b])}};j.prototype.filter=function(a){var f=this,c=a.store,b=a.key,d=a.value,e=a.order,k=a.orderCol,i=a.limit,l=n(this.db,c),j,m=[];g(l,cc+"filtering "+b+" for "+d+" from "+c);l=l.objectStore(store);g(l,bb+c);b=l.index(b);d=z.only(d);d=b.openCursor(d);d.onsuccess=function(b){(j=b.target.result)?(m.push(j.value),j[ee]()):(e&&k&&(m.sort(function(a,c){var b=a[k],d=c[k];return b<d?-1:b>d?
1:0}),"desc"===e&&m.reverse()),i&&(m=m.slice(0,i)),h(a.success,f,[m,c,b]))};d.onerror=function(b){h(a.error,f,[c,b])}};j.prototype.clear=function(a){var f=this,c=a.store,b=n(this.db,c,!0);g(b,cc+"clearing "+c);b=b.objectStore(c);g(b,bb+c);b=b.clear();b.onsuccess=function(b){h(a.success,f,[c,b])};b.onerror=function(b){h(a.error,f,[c,b])}};j.prototype.count=function(a){var f=this,c=a.store,b=a.key,d=a.value,e=n(this.db,c,!0);g(e,cc+"counting "+c);e=e.objectStore(c);
g(e,bb+c);b&&d?(b=e.index(b),d=z.only(d),d=b.count(d)):d=e.count();d.onsuccess=function(b){h(a.success,f,[b.target.result,c,b])};d.onerror=function(){h(a.error,f,[c,$e])}}};
